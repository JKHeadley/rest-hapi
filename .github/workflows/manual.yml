# This is a basic workflow that is manually triggered

# HOW TO USE
# One of the challenges with testing NEW github workflows is that you can't trigger them without first
# having the workflow existing in the main branch of the repo.
# Once that workflow is there, you can update the workflow on any branch, and run that branch's version
# of the workflow. So to use this and test a manually triggered workflow:
# 1. Check out a new branch and modify this file
# 2. Push your branch, then in your browser, navigate to the Github workflow
# 3. Click on "Manual workflow" and trigger it, specifying your branch.

name: Manual workflow

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      name:
        # Friendly description to be shown in the UI instead of 'name'
        description: 'Person to greet'
        # Default value if no value is explicitly provided
        default: 'World'
        # Input has to be provided for the workflow to run
        required: true

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
# jobs:
#   deploy-docs:

#     runs-on: ubuntu-latest

#     steps:
#       - uses: actions/checkout@v3
#       - name: Deploy docs
#         uses: actions/setup-node@v3
#         with:
#           node-version: 12.14.1
#       - uses: oleksiyrudenko/gha-git-credentials@v2-latest
#         with:
#           token: '${{ secrets.GITHUB_TOKEN }}'
#       - run: echo "${GH_NAME}"
#       - run: echo $GH_NAME
#       - run: echo "${GH_EMAIL}"
#       - run: echo $GH_EMAIL
#       - run: git config --global user.name "${GH_NAME}"
#       - run: git config --global user.email "${GH_EMAIL}"
#       - run: echo "machine github.com login ${GH_NAME} password ${GH_TOKEN}" > ~/.netrc
#       - run: cd website && yarn install && GIT_USER="${GH_NAME}" yarn run publish-gh-pages

# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@master
#       - uses: redkubes/docusaurus-deploy-action@v1
#         with:
#           source-folder: website
#           git-user: JKHeadley
#           git-password: ${{ secrets.GITHUB_TOKEN }}
#           deployment-branch: gh-pages

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Check out repo
        uses: actions/checkout@v2
      # Node is required for npm
      - name: Set up Node
        uses: actions/setup-node@v2
        with:
          node-version: "12.14.1"
      # Install and build Docusaurus website
      - name: Build Docusaurus website
        run: |
          cd website
          yarn install 
          yarn run build
      - name: Deploy to GitHub Pages
        if: success()
        uses: crazy-max/ghaction-github-pages@v2
        with:
          target_branch: gh-pages
          build_dir: website/build
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}